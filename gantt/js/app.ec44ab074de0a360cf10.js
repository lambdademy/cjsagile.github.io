webpackJsonp([1],{0:function(t,e){},"1gaf":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAAtCAYAAAAZQbNPAAAABGdBTUEAALGPC/xhBQAAAgdJREFUaAXtmr1KA0EQx2f39hITTWFAkCCCIFiIH6WFWvgMYuEDRCx8A1/CUqxsfQEtxUItFEUEFcTGwhSCn5dwH7vjrFiokGrjxWV3wnFcwu7Nb/57NzOXY9sXtytKsRlwzAZDPBZXb+nSU4wLnLlDnyDCWE9xWEQJsJZEcAk+I/imSpngTKEGdwme0yInXtR7Z83Duyq9V94r72AEhCRo/Npc4de8CoGJPhEUm1ICc6jCCwi+wAHFVFGuncZZv9DfuGIZQDVN713B9Zw+At8iYHSbq9fr4fLq/HSlVK1kki4kiyx9iq6N4PdPt+Ya0dGBROqL6WOLaX8HyhN7wsThRDQLqYxAYmoVvCJ/4+y5ZARPj0CQsYDAqU6wSHkGny2N9I2NydK3eaxX3mb1THz3yptEz+axhsrbVdX9FsoozwcJCxAl6A0syvNK+8x52Qi+0KqdD/XNrjfVa0h/A/wO7L89zkDBSGXy/N866B3zEfi7CHS9Dz3cOaz+HV77mU8aJ1FX4c927jYfL5NFZnTbbQ/Y7hednPpH+W7Op/3pTvQC4/GDrPIwXw0UvY/wLmC4q/BCqpgL6q5zhtcSsCKm9iTnn4umI0ceviNhtHASr7yFonXEZa98R8Jo2yRU6HQ1zyuGJaSCA2W+RY4+Jw+EWT9vKna5xjYKveWb3J+D0KsZvYPh8QfpppkmFUF/MwAAAABJRU5ErkJggg=="},"5W1q":function(t,e){},DF7B:function(t,e){},N6dn:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("7+uW"),n=a("mtWM"),i=a.n(n),o=a("MpSA"),r=a.n(o),l=a("9fd9"),c=a.n(l),d=a("zL8q"),u=a.n(d),m=(a("tvR6"),a("aqYZ"),a("NYxO")),h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var f=a("VU/8")({name:"App"},h,!1,function(t){a("txc+")},null,null).exports,p=a("/ocq"),v={name:"menu",data:function(){return{userData:JSON.parse(localStorage.getItem("userInfo"))}},computed:{avatarUser:function(){return this.userData?this.userData.photo:""},displayNameUser:function(){if(this.userData)return this.userData.full_name}},methods:{logout:function(){localStorage.removeItem("token"),localStorage.removeItem("userInfo"),q.replace("/login")}}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-menu",{staticClass:"el-menu-gantt",attrs:{"default-active":"1",mode:"horizontal"}},[s("el-menu-item",{staticClass:"menu__logo",attrs:{index:"1"}},[s("img",{attrs:{src:a("1gaf"),width:"30px"}}),t._v("\n      CJS's Gantt\n  ")]),t._v(" "),s("el-submenu",{staticClass:"menu__profile",attrs:{index:"2"}},[s("template",{slot:"title"},[s("img",{staticClass:"menu__profile_avatar",attrs:{src:t.avatarUser}})]),t._v(" "),s("el-menu-item",{staticClass:"menu__profile__display_name",attrs:{index:"2-1"}},[t._v(t._s(t.displayNameUser))]),t._v(" "),s("el-menu-item",{attrs:{index:"2-2"},on:{click:t.logout}},[t._v("Đăng xuât")])],2)],1)},staticRenderFns:[]};var k=a("VU/8")(v,g,!1,function(t){a("aqUQ")},"data-v-6069da50",null).exports,b=a("woOf"),w=a.n(b),y={name:"Comment",data:function(){return{user_login:JSON.parse(localStorage.getItem("userInfo")),config:{toolbarSticky:!1,spellcheck:!1,charCounterCount:!1,toolbarButtons:["bold","italic","underline","strikeThrough","subscript","superscript","paragraphFormat","align","formatOL","formatUL","indent","outdent","insertImage","insertLink","insertFile"]},mode_show_attachments:"text",url:this.$urlAPI+"/userstories/attachments",headers:{Authorization:"Bearer "+localStorage.getItem("token")},fileList:[],row_comment:5,data_activities_task_show:[],array_field_log_has_type_array:["assigned_to","status","milestone","description_diff","subject"],array_field_log_has_type_obj:["custom_attributes","points"],comment_msg:"",convent_field:{assigned_to:"assigned to",status:"status",description_diff:"description",milestone:"Sprint",subject:"subject",created_custom_attributes:"created custom attributes",updated_custom_attributes:"updated custom attributes"},mode_comment:"comment",id_edit_comment:""}},computed:{count_comment:function(){if(this.data_activities_task_show)return this.data_activities_task_show.reduce(function(t,e){return e.comment?t+1:t},0)},count_activities:function(){if(this.data_activities_task_show)return this.data_activities_task_show.reduce(function(t,e){return t+1},0)},data_attach_file:function(){return{project:1,object_id:this.taskId,from_comment:!1}}},props:{dataActivitiesTask:{type:Array,default:[]},taskId:{type:[String,Number],default:""},listAttachFile:{type:Array,default:[]}},watch:{dataActivitiesTask:function(t){t&&(this.data_activities_task_show=t)},listAttachFile:function(t){t&&(this.fileList=t)}},methods:{trigger_edit_comment:function(t){alert("fuckkkk"),console.log(t),this.mode_comment="edit_comment",this.comment_msg=t.comment,this.id_edit_comment=t.id,alert(this.mode_comment)},trigger_deleted_comment:function(t){this.$emit("deleted-comment",t.id)},mode_show_module_attach:function(){this.mode_show_attachments="text"},mode_show_list_attach:function(){this.mode_show_attachments="text"},handleRemove:function(t,e){console.log(t,e);var a={Authorization:"Bearer "+localStorage.getItem("token")};i.a.delete(this.$urlAPI+"/userstories/attachments/"+t.id,{headers:a}).then(function(t){})},handlePreview:function(t){console.log(t)},handleExceed:function(t,e){this.$message.warning("The limit is 3, you selected "+t.length+" files this time, add up to "+(t.length+e.length)+" totally")},beforeRemove:function(t,e){return this.$confirm("Bạn có chắc muốn xóa "+t.name+"？")},show_description:function(t){if(t.length>0)return t.forEach(function(e,a){null!=e&&""!=e||(t[a]="...")}),t.join(" &rsaquo; ")},get_title:function(t,e){return"custom_attributes"==t&&e?e.changed&&e.changed.length>0?this.convent_field.updated_custom_attributes:e.new&&e.new.length>0?this.convent_field.created_custom_attributes:void 0:this.convent_field.hasOwnProperty(t)&&e?this.convent_field[t]:t},get_name_field_actived:function(t){return t.changed&&t.changed.length>0?t.changed[0].name:t.new&&t.new.length>0?t.new[0].name:void 0},get_content_field_actived:function(t){return t.changed&&t.changed.length>0?t.changed[0].changes&&t.changed[0].changes.value.length>0?(t.changed[0].changes.value.forEach(function(e,a){null!=e&&""!=e||(t.changed[0].changes.value[a]="...")}),t.changed[0].changes.value.join(" &rsaquo; ")):void 0:t.new&&t.new.length>0?t.new[0].value_diff:void 0},save_comment:function(){var t=a("OKs0")(this.comment_msg,{gfm:!0});if("comment"==this.mode_comment)this.$emit("push-comment",t);else if("edit_comment"==this.mode_comment){var e={id:this.id_edit_comment,comment:t};this.$emit("push-edit-comment",e)}this.comment_msg=""},cancel_comment:function(){this.comment_msg=""}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{name:"attached_file",action:t.url,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"before-remove":t.beforeRemove,multiple:"","thumbnail-mode":!0,data:t.data_attach_file,headers:t.headers,"on-exceed":t.handleExceed,"list-type":t.mode_show_attachments,"file-list":t.fileList}},[a("div",{staticClass:"btn-attach title-add_attach"},[a("span",[t._v("attachments")])]),t._v(" "),a("div",{staticClass:"btn-attach mode_add_attach"},[a("i",{staticClass:"material-icons",on:{click:function(e){t.mode_show_module_attach()}}},[t._v("view_module")]),t._v(" "),a("i",{staticClass:"material-icons",on:{click:function(e){t.mode_show_list_attach()}}},[t._v("list")])]),t._v(" "),a("div",{staticClass:"btn-attach add_attach",attrs:{slot:"trigger"},slot:"trigger"},[a("i",{staticClass:"material-icons"},[t._v("add_box")])])])],1),t._v(" "),a("el-tabs",{staticClass:"comments-activities-tabs",attrs:{type:"border-card"}},[a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.count_comment)+" Comments")]),t._v(" "),t._l(t.data_activities_task_show,function(e,s){return a("div",{staticClass:"container-comment"},[e.comment&&!e.delete_comment_date?a("span",{staticClass:"comments-task"},[a("el-row",{staticClass:"comment-row",attrs:{gutter:10}},[a("el-col",{attrs:{span:1}},[a("div",[a("img",{staticStyle:{"border-radius":"50%",width:"50px"},attrs:{src:e.user.photo}})])]),t._v(" "),a("el-col",{attrs:{span:21}},[a("div",{staticClass:"content-comment-task"},[a("span",{staticClass:"user-comment-display-name"},[t._v(t._s(e.user.name))]),t._v(" "),a("span",{staticClass:"user-comment-display-name"},[t._v(t._s(t._f("moment")(e.created_at,"DD/MM/YYYY HH:mm")))]),t._v(" "),e.edit_comment_date?a("span",{staticClass:"time-edit-comment"},[t._v("đã chỉnh sửa: "+t._s(t._f("moment")(e.edit_comment_date,"DD/MM/YYYY HH:mm")))]):t._e(),t._v(" "),a("div",{staticClass:"comment-box",domProps:{innerHTML:t._s(e.comment_html)}})])]),t._v(" "),e.user.pk==t.user_login.id?a("el-col",{staticClass:"edit-deleted-comment",attrs:{span:2}},[a("i",{staticClass:"material-icons icon-deleted-comment",on:{click:function(a){t.trigger_deleted_comment(e)}}},[t._v("delete_forever")]),t._v(" "),a("i",{staticClass:"material-icons icon-edit-comment",on:{click:function(a){t.trigger_edit_comment(e)}}},[t._v("edit")])]):t._e()],1)],1):t._e()])}),t._v(" "),a("div",{staticClass:"btn-confirm-comment"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:23}},[a("froala",{attrs:{tag:"textarea",config:t.config},model:{value:t.comment_msg,callback:function(e){t.comment_msg=e},expression:"comment_msg"}})],1),t._v(" "),a("el-col",{attrs:{span:1}},[a("div",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Save",placement:"right"}},[a("i",{staticClass:"material-icons save-comment",on:{click:function(e){t.save_comment()}}},[t._v("save")])])],1),t._v(" "),a("div",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Cancel",placement:"right"}},[a("i",{staticClass:"material-icons cancel-comment",on:{click:function(e){t.cancel_comment()}}},[t._v("close")])])],1)])],1)],1)],2),t._v(" "),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.count_activities)+" Activities")]),t._v(" "),t._l(t.data_activities_task_show,function(e,s){return a("div",[a("span",{staticClass:"activitie-task"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:1}},[a("div",[a("img",{staticStyle:{"border-radius":"50%",width:"50px"},attrs:{src:e.user.photo}})])]),t._v(" "),a("el-col",{attrs:{span:23}},[e.values_diff?a("div",{staticClass:"content-comment-task"},[a("span",{staticClass:"user-comment-display-name"},[t._v(t._s(e.user.name))]),t._v(" "),a("span",{staticClass:"user-comment-display-name"},[t._v(t._s(t._f("moment")(e.created_at,"DD/MM/YYYY HH:mm")))]),t._v(" "),e.edit_comment_date?a("span",{staticClass:"time-edit-comment"},[t._v("đã chỉnh sửa: "+t._s(t._f("moment")(e.edit_comment_date,"DD/MM/YYYY HH:mm")))]):t._e(),t._v(" "),a("div",t._l(e.values_diff,function(e,s){return a("div",{staticClass:"comment-box"},[t.array_field_log_has_type_array.includes(s)?a("div",[a("div",{staticClass:"title-active-task",domProps:{innerHTML:t._s(t.get_title(s,e))}}),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.show_description(e))}})]):t._e(),t._v(" "),t.array_field_log_has_type_obj.includes(s)?a("div",[a("div",{staticClass:"title-active-task",domProps:{innerHTML:t._s(t.get_title(s,e))}}),t._v(" "),"custom_attributes"==s?a("div",[a("span",{domProps:{innerHTML:t._s(t.get_name_field_actived(e))}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(t.get_content_field_actived(e))}})]):t._e()]):t._e()])}),0)]):t._e()])],1)],1)])})],2)],1)],1)},staticRenderFns:[]};var D=a("VU/8")(y,C,!1,function(t){a("N6dn")},"data-v-7dd027f4",null).exports,A=a("fZjL"),x=a.n(A),S={name:"point",props:{points:{type:Array,default:function(){return[]}},pointsData:{type:Array,default:function(){return[]}},taskDetail:{type:Object,default:{}}},computed:{sumPoints:function(){var t=0,e=this,a=x()(this.taskDetail.points);return a&&a.forEach(function(a){t+=e.getPointByID(a,!0)||0}),t}},methods:{handleCommand:function(t){this.taskDetail.points[t.id]=t.item.id,this.updatePointTask()},getPointByID:function(t,e){var a=this.taskDetail.points[t];return this.points.find(function(t){return t.id==a}).value||(e?0:"?")},updatePointTask:function(){var t=this,e={Authorization:"Bearer "+localStorage.getItem("token")},a={points:this.taskDetail.points,version:this.taskDetail.version};i.a.patch(t.$urlAPI+"/userstories/"+t.taskDetail.id,a,{headers:e}).then(function(e){t.taskDetail.version+=1})}}},T={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticStyle:{"margin-top":"20px"}},[t._l(t.pointsData,function(e){return a("el-col",{key:e.id,attrs:{span:24}},[a("el-dropdown",{attrs:{placement:"top-start"},on:{command:t.handleCommand}},[a("el-button",{attrs:{size:"medium",type:"primary"}},[a("el-col",{attrs:{span:4}},[t._v(t._s(t.getPointByID(e.id))+" "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-col",{attrs:{span:20}},[a("span",{staticStyle:{float:"right"}},[t._v(t._s(e.title))])])],1),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.points,function(s){return a("el-dropdown-item",{key:s.id,attrs:{command:{item:s,id:e.id}}},[t._v("\n                   "+t._s(s.name)+"\n               ")])}),1)],1)],1)}),t._v(" "),a("el-col",{staticClass:"detailTask__total_point",attrs:{span:24}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:4}},[t._v("\n             "+t._s(t.sumPoints)+"\n         ")]),t._v(" "),a("el-col",{attrs:{span:20}},[a("span",{staticStyle:{float:"right"}},[t._v("Total Points")])])],1)],2)},staticRenderFns:[]};var P=a("VU/8")(S,T,!1,function(t){a("xoGc")},"data-v-296b42c4",null).exports,I={name:"custom_field",data:function(){return{openCustomField:["1"]}},props:{taskDetail:{type:Object,default:function(){return{}}},customAttr:{type:Array,default:[]}},methods:{getValueAttr:function(t){return this.taskDetail.attributes_values[t]},saveAttr:function(){var t={attributes_values:this.taskDetail.attributes_values,version:this.taskDetail.version_attr},e=this,a={Authorization:"Bearer "+localStorage.getItem("token")};i.a.patch(e.$urlAPI+"/userstories/custom-attributes-values/"+e.taskDetail.id,t,{headers:a}).then(function(t){e.$set(e.taskDetail,"version",t.data.version_attr)})}}},$={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-collapse",{model:{value:t.openCustomField,callback:function(e){t.openCustomField=e},expression:"openCustomField"}},[a("el-collapse-item",{attrs:{title:"Custom Field",name:"1"}},t._l(t.customAttr,function(e){return a("el-col",{key:e.id,staticClass:"customField__container",staticStyle:{"margin-bottom":"10px"},attrs:{span:12}},[a("el-col",{attrs:{span:10}},[a("h3",{staticClass:"demo-input-label"},[t._v(t._s(e.name))]),t._v(" "),a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.description))])]),t._v(" "),a("el-col",{attrs:{span:13}},[9==e.id?a("el-date-picker",{attrs:{type:"date",placeholder:"Pick a day"},model:{value:t.taskDetail.attributes_values[e.id],callback:function(a){t.$set(t.taskDetail.attributes_values,e.id,a)},expression:"taskDetail.attributes_values[attr.id]"}}):a("el-input",{attrs:{type:"textarea",autosize:{minRows:6,maxRows:6}},model:{value:t.taskDetail.attributes_values[e.id],callback:function(a){t.$set(t.taskDetail.attributes_values,e.id,a)},expression:"taskDetail.attributes_values[attr.id]"}})],1),t._v(" "),a("el-col",{staticClass:"btn-confirm-comment",attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Save",placement:"right"}},[a("i",{staticClass:"material-icons save-comment",on:{click:t.saveAttr}},[t._v("save")])])],1)],1)}),1)],1)],1)],1)},staticRenderFns:[]};var j=a("VU/8")(I,$,!1,function(t){a("w4ko")},"data-v-e71a97fe",null).exports,z={name:"modal_detail_task",components:{VueFroala:c.a,Comment:D,Point:P,CustomField:j},data:function(){return{status_task:{},pointsData:[{title:"Product Owner",id:5},{title:"Developer",id:19},{title:"Sale",id:20},{title:"Deploy",id:21},{title:"Designer",id:233}],user_login:JSON.parse(localStorage.getItem("userInfo")),task:{},mode_assign:"assign_to",arr_watcher_new:"",search_staff:"",show_add_watch:!1,isEditTitleTask:!1,editor:null,data_activities_task:[],list_attach_file:[],config:{fontSizeDefaultSelection:"16",heightMax:700,heightMin:600,toolbarSticky:!1,spellcheck:!1,charCounterCount:!1,toolbarButtons:["bold","italic","underline","strikeThrough","subscript","superscript","paragraphFormat","align","formatOL","formatUL","indent","outdent","insertImage","insertLink","insertFile"]}}},mounted:function(){},computed:{urlToSave:function(){return this.$urlAPI+"/userstories/"+this.taskDetail.id}},beforeDestroy:function(){},props:{dataProject:{type:[Array,Object],default:function(){return{}}},points:{type:Array,default:function(){return[]}},customAttr:{type:Array,default:function(){return[]}},dialogVisible:{type:Boolean,default:!1},taskDetail:{type:Object,default:{}},members:{type:[Array,Object],default:[]}},watch:{dialogVisible:function(t){t&&(this.getDetailTask(),this.get_data_activities_task(),this.get_attach_file())},taskDetail:function(t){t&&(this.task=w()(this.task,t))}},methods:{update_version:function(){this.task.version+=1},show_search_watcher:function(){this.show_add_watch=!0,this.mode_assign="watchers"},show_modal_assign_to:function(){this.show_add_watch=!0,this.mode_assign="assign_to"},assign_to_me:function(){this.mode_assign="assign_to_me",this.add_watcher_and_assign_to()},handleSelect:function(t){console.log(t.id),this.search_staff=t.full_name_display,this.arr_watcher_new=t.id},querySearch:function(t,e){var a=_.toArray(this.members);console.log(a),e(t?a.filter(this.createFilter(t)):a)},createFilter:function(t){return function(e){return 0===e.full_name_display.toLowerCase().indexOf(t.toLowerCase())}},handleClose:function(t,e){var a=this;this.$confirm("Bạn có chắc muốn xóa "+this.members[t].full_name_display,{confirmButtonText:"Xác nhận",cancelButtonText:"",type:"warning"}).then(function(){console.log(e),"watchers"==e?(a.task.watchers.splice(a.task.watchers.indexOf(t),1),a.deleted_watcher_and_assign_to(a.task.watchers,"watchers")):"assign"==e&&a.deleted_watcher_and_assign_to(null,"assign")}).catch(function(){})},deleted_watcher_and_assign_to:function(t,e){var a=this,s={};"assign"==e?s=w()({},{version:a.task.version,assigned_to:null}):"watchers"==e&&(s={version:a.task.version,watchers:t});var n={Authorization:"Bearer "+localStorage.getItem("token")};i.a.patch(a.$urlAPI+"/userstories/"+a.taskDetail.id,s,{headers:n}).then(function(t){t.data&&("watchers"==e&&(a.$set(a,"task",t.data),a.$set(a.task,"watchers",t.data.watchers)),"assign"==e&&(a.$set(a,"task",t.data),a.$set(a.task,"assigned_to_extra_info",t.data.assigned_to_extra_info),a.$set(a.task,"assigned_to",t.data.assigned_to)),a.$set(a.task,"version",t.data.version)),a.$forceUpdate()})},add_watcher_and_assign_to:function(){var t=this,e={};console.log(t.mode_assign),"assign_to"==t.mode_assign?e={version:t.task.version,assigned_to:t.arr_watcher_new}:"assign_to_me"==t.mode_assign?e={version:t.task.version,assigned_to:t.user_login.id}:"watchers"==t.mode_assign&&(t.task.watchers.push(t.arr_watcher_new),e={version:t.task.version,watchers:t.task.watchers});var a={Authorization:"Bearer "+localStorage.getItem("token")};i.a.patch(t.$urlAPI+"/userstories/"+t.taskDetail.id,e,{headers:a}).then(function(e){console.log(e),t.show_add_watch=!1,console.log(e.data.version),e.data&&("watchers"==t.mode_assign&&(t.$set(t,"task",e.data),t.$set(t.task,"watchers",e.data.watchers)),"assign_to"!=t.mode_assign&&"assign_to_me"!=t.mode_assign||(t.$set(t,"task",e.data),t.$set(t.task,"assigned_to_extra_info",e.data.assigned_to_extra_info),t.$set(t.task,"assigned_to",e.data.assigned_to)),t.$set(t.task,"version",e.data.version),t.search_staff=""),t.$forceUpdate()}).catch(function(){t.show_add_watch=!1,t.search_staff=""})},save:function(){var t=a("OKs0"),e=this,s={Authorization:"Bearer "+localStorage.getItem("token")},n={description:t(this.task.description_html,{gfm:!0}),version:e.task.version};i.a.patch(e.$urlAPI+"/userstories/"+e.task.id,n,{headers:s}).then(function(t){e.task.version+=1})},submit:function(t){t.preventDefault()},editTitleTask:function(){var t=this;t.isEditTitleTask=!0,setTimeout(function(){t.$refs.titleInput.$refs.textarea.focus()},300)},closeModal:function(){this.$emit("close-modal")},getDetailTask:function(){var t=this,e={Authorization:"Bearer "+localStorage.getItem("token")};i.a.get(t.$urlAPI+"/userstories/by_ref?order_by=kanban_order&project=1&ref="+t.taskDetail.ref,{headers:e}).then(function(e){t.$set(t,"task",e.data),t.task.description_html=e.data.description_html,t.$forceUpdate()})},get_data_activities_task:function(){var t=this,e={"x-disable-pagination":!1,Authorization:"Bearer "+localStorage.getItem("token")};i.a.get(t.$urlAPI+"/history/userstory/"+t.taskDetail.id,{headers:e}).then(function(e){e&&e.data.length>0&&(t.data_activities_task=e.data)})},delete_comment_task:function(t){var e=this,a={Authorization:"Bearer "+localStorage.getItem("token")};i.a.post(e.$urlAPI+"/history/userstory/"+e.taskDetail.id+"/delete_comment?id="+t,{},{headers:a}).then(function(t){e.get_data_activities_task()})},push_comment_task:function(t){var e={version:this.task.version,comment:t},a=this,s={Authorization:"Bearer "+localStorage.getItem("token")};i.a.patch(a.$urlAPI+"/userstories/"+a.taskDetail.id,e,{headers:s}).then(function(t){a.get_data_activities_task(),t.data&&a.$set(a.task,"version",t.data.version)})},push_edit_comment_task:function(t){var e=this,a={comment:t.comment},s={Authorization:"Bearer "+localStorage.getItem("token")};i.a.post(e.$urlAPI+"/history/userstory/"+e.taskDetail.id+"/edit_comment?id="+t.id,a,{headers:s}).then(function(t){e.get_data_activities_task()})},get_attach_file:function(){var t=this,e={Authorization:"Bearer "+localStorage.getItem("token")};i.a.get(t.$urlAPI+"/userstories/attachments?object_id="+t.taskDetail.id+"&project=1",{headers:e}).then(function(e){t.list_attach_file=e.data})}}},F={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("el-dialog",{attrs:{visible:t.dialogVisible,"close-on-click-modal":!1,"before-close":t.closeModal,fullscreen:!0,"show-close":!1,width:"80%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("span",{attrs:{slot:"title"},on:{click:t.editTitleTask},slot:"title"},[a("h2",{directives:[{name:"show",rawName:"v-show",value:!t.isEditTitleTask,expression:"!isEditTitleTask"}],staticClass:"refTaskID"},[t._v("#"+t._s(t.task.ref))]),t._v(" "),a("el-input",{ref:"titleInput",attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",disabled:!t.isEditTitleTask},on:{blur:function(e){t.isEditTitleTask=!1}},nativeOn:{keypress:function(e){return"button"in e||13===e.keyCode?t.submit(e):null}},model:{value:t.task.subject,callback:function(e){t.$set(t.task,"subject",e)},expression:"task.subject"}})],1),t._v(" "),a("span",[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-col",{attrs:{span:18}},[a("el-card",{staticClass:"box-card custom-editor"},[a("div",{staticClass:"btn-confirm-comment"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:23}},[a("froala",{attrs:{tag:"textarea",config:t.config},model:{value:t.task.description_html,callback:function(e){t.$set(t.task,"description_html",e)},expression:"task.description_html"}})],1),t._v(" "),a("el-col",{attrs:{span:1}},[a("div",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Save",placement:"right"}},[a("i",{staticClass:"material-icons save-comment",on:{click:function(e){t.save()}}},[t._v("save")])])],1)])],1)],1)]),t._v(" "),a("custom-field",{attrs:{"task-detail":t.taskDetail,"custom-attr":t.customAttr}})],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-card",{staticClass:"box-card",staticStyle:{"min-height":"203px"}},[a("el-row",[a("p",[a("b",[t._v("Trạng thái task")])]),t._v(" "),a("el-select",{attrs:{placeholder:"Select"},model:{value:t.status_task,callback:function(e){t.status_task=e},expression:"status_task"}},t._l(t.dataProject.epic_statuses,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("point",{attrs:{points:t.points,"task-detail":t.taskDetail,"points-data":t.pointsData}}),t._v(" "),a("div",{staticStyle:{padding:"10px 0px"}},[a("el-row",[null==t.task.assigned_to?a("div",[a("el-alert",{attrs:{title:"Chưa có người đảm nhận",closable:!1,type:"error"}}),t._v(" "),a("el-button",{staticClass:"add-watchers",attrs:{size:"mini"},on:{click:function(e){t.show_modal_assign_to()}}},[a("i",{staticClass:"material-icons icon-add-watchers"},[t._v("add")]),t._v(" "),a("span",[t._v("Phân công")])]),t._v(" "),a("el-button",{staticClass:"add-watchers",attrs:{size:"mini"},on:{click:function(e){t.assign_to_me()}}},[a("i",{staticClass:"material-icons icon-add-watchers"},[t._v("add")]),t._v(" "),a("span",[t._v("Phân công cho tôi")])])],1):a("div",[a("p",[a("b",[t._v("Người đảm nhận")])]),t._v(" "),a("el-tag",{key:t.task.assigned_to,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){t.handleClose(t.task.assigned_to,"assign")}}},[[a("img",{attrs:{src:t.task.assigned_to_extra_info.photo}}),t._v(" "),a("p",{staticClass:"name-watchers"},[t._v(t._s(t.task.assigned_to_extra_info.full_name_display))])]],2)],1)]),t._v(" "),a("el-row",[a("p",{staticStyle:{display:"inline-block"}},[a("b",[t._v("Người theo dõi")])]),t._v(" "),a("el-button",{staticClass:"add-watchers",attrs:{size:"mini"},on:{click:function(e){t.show_search_watcher()}}},[a("i",{staticClass:"material-icons icon-add-watchers"},[t._v("add")]),t._v(" "),a("span",[t._v("Thêm")])]),t._v(" "),a("div",t._l(t.task.watchers,function(e){return a("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){t.handleClose(e,"watchers")}}},[t.members[e]?[a("img",{attrs:{src:t.members[e].photo}}),t._v(" "),a("p",{staticClass:"name-watchers"},[t._v(t._s(t.members[e].full_name_display))])]:t._e()],2)}),1)],1)],1)],1)],1)],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:18}},[a("comment",{attrs:{dataActivitiesTask:t.data_activities_task,listAttachFile:t.list_attach_file,taskId:t.task.id},on:{"push-comment":function(e){t.push_comment_task(e)},"push-edit-comment":function(e){t.push_edit_comment_task(e)},"deleted-comment":function(e){t.delete_comment_task(e)}}})],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})]),t._v(" "),a("el-dialog",{attrs:{title:"Tìm người đảm nhận",visible:t.show_add_watch,width:"30%","append-to-body":""},on:{"update:visible":function(e){t.show_add_watch=e}}},[a("el-autocomplete",{attrs:{"popper-class":"search-assign-to-task","fetch-suggestions":t.querySearch},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.item;return[a("img",{attrs:{src:s.photo}}),t._v(" "),a("p",{staticClass:"name-watchers"},[t._v(t._s(s.full_name_display))])]}}]),model:{value:t.search_staff,callback:function(e){t.search_staff=e},expression:"search_staff"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.show_add_watch=!1}}},[t._v("Cancel")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.add_watcher_and_assign_to()}}},[t._v("Confirm")])],1)],1)],1)},staticRenderFns:[]};var M={name:"gantt",components:{MenuTop:k,ModalDetailTask:a("VU/8")(z,F,!1,function(t){a("DF7B"),a("k/SZ")},"data-v-1b7cfaa4",null).exports},mounted:function(){localStorage.getItem("token")?(this.getDataProject(),this.getDataMileStone(),this.getDataTaskSprint()):q.replace("/login")},data:function(){return{pageSize:50,totalTask:0,currentPage:1,loading:!1,value:null,datetimeTask:null,options1:["list","of","options"],assingedUser:[],dataMileStone:{},dataTaskSpint:[],deadline_status__class:[],dataProject:[],columnList:[],dialogVisible:!1,currentTaskData:{},members:[],token:JSON.parse(localStorage.getItem("token"))}},methods:{handleSizeChange:function(t){console.log(t+" items per page"),console.log(this.dataTaskSpint.length),console.log(this.dataTaskSpint.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize))},handleCurrentChange:function(t){console.log("current page: "+t)},closeModal:function(){this.dialogVisible=!1},rowClick:function(t){var e=this;this.currentTaskData=t,this.$confirm("Bạn muốn xem chi tiết Task tại đây hay xem qua kanban?","Điều hướng",{distinguishCancelAndClose:!0,confirmButtonText:"Tại đây",cancelButtonText:"Kanban"}).then(function(){e.dialogVisible=!0}).catch(function(t){"cancel"==t&&window.open("https://a.happyworking.life/project/fountainhead-cloudjet-kpi/us/"+e.currentTaskData.ref,"_blank")})},sortProgressDate:function(t,e){return void 0===t.attributes_values[9]||void 0===e.attributes_values[9]?t.attributes_values[9]||void 0==e.attributes_values[9]:this.getSubtractTime(t).diff-this.getSubtractTime(e).diff},sortFinishDate:function(t,e){return void 0===t.finish_date||void 0===e.finish_date?t||void 0==e:new Date(t.finish_date).getTime()-new Date(e.finish_date).getTime()},sortDateTime:function(t,e){return void 0===t.attributes_values[9]||void 0===e.attributes_values[9]?t||void 0==e:new Date(t.attributes_values[9]).getTime()-new Date(e.attributes_values[9]).getTime()},filterTag:function(t,e){return e.assigned_to===t},filterColumn:function(t,e){return e.status_extra_info.name===t},getClassMessage:function(t){var e="";switch(t){case 1:case 2:e="done";break;case 4:e="danger";break;case 5:e="warning"}return e},getMessageDeadline:function(t,e){var a={1:"Đã hoàn thành được "+e+" ngày",2:"Đúng hạn",3:"Còn 0 ngày",4:"Quá "+e+" ngày",5:"Còn "+-1*e+" ngày"};return-1!=["1","4","5"].indexOf(t)||e>=0?a[t]:""},getSubtractTime:function(t){var e=t.attributes_values[9],a=Vue.moment(),s=0;return{result:t.is_closed?(s=Vue.moment(e).diff(Vue.moment(t.finish_date),"days"))>0?1:2:0==(s=Vue.moment(a).diff(Vue.moment(e),"days"))?3:s>0?4:5,diff:s}},tableRowClassName:function(t){var e=t.row;t.rowIndex;return 232===e.status?"row-ux-review":3===e.status?"row-coding":244===e.status?"row-":257===e.status?"row-intergration-test":""},getAttrTaskData:function(t){var e=this,a={Authorization:"Bearer "+this.token};i.a.get(e.$urlAPI+"/userstories/custom-attributes-values/"+t.id,{headers:a}).then(function(a){t.attributes_values=a.data.attributes_values,t.version_attr=a.data.version,e.dataTaskSpint.push(t)})},customNameUser:function(t){var e=t.full_name;return""===e?"Chưa có người đảm nhận":e},getDataTaskSprint:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this;e.loading=!0;var a={include_attachment:1,include_tasks:1,project:1,status__is_archived:!1,page:t},s={Authorization:"Bearer "+this.token},n=i.a.get(e.$urlAPI+"/userstories",{params:a,headers:s});return n.then(function(a){e.totalTask=a.headers["x-pagination-count"],a.headers["x-pagination-next"]&&e.getDataTaskSprint(t+=1),a.data.forEach(function(t,a){e.getAttrTaskData(t,a)}),e.loading=!1}),n},getDataMileStone:function(){var t=this;i.a.get(t.$urlAPI+"/userstories/filters_data",{params:{project:1}}).then(function(e){t.dataMileStone=e.data,t.assingedUser=e.data.assigned_to.map(function(t){var e=t;return e.text=""===e.full_name?"Chưa có người đảm nhận":e.full_name,e.value=e.id,e})})},getDataProject:function(){var t=this,e={Authorization:"Bearer "+this.token};i.a.get(t.$urlAPI+"/projects/by_slug",{params:{slug:"fountainhead-cloudjet-kpi"},headers:e}).then(function(e){t.dataProject=e.data,t.members=e.data.members,t.members.length>0&&(t.members=_.keyBy(t.members,"id")),t.dataProject.us_statuses=e.data.us_statuses.map(function(t){var e=t;return e.text=t.name,e.value=t.name,e})})}}},Y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("el-row",[a("el-col",{attrs:{span:24}},[a("menu-top")],1)],1),t._v(" "),a("el-row",{staticClass:"gantt-container"},[a("el-row",{attrs:{span:24}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{height:"85vh",data:t.dataTaskSpint.slice((t.currentPage-1)*t.pageSize,t.currentPage*t.pageSize),"default-sort":{prop:"id",order:"descending"},"row-class-name":t.tableRowClassName},on:{"row-click":t.rowClick}},[a("el-table-column",{attrs:{prop:"ref",label:"#",sortable:"",width:"70"}}),t._v(" "),a("el-table-column",{attrs:{filters:t.dataProject.us_statuses,prop:"status_extra_info[name]",label:"Cột","filter-method":t.filterColumn,"filter-placement":"bottom-end",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"subject",sortable:"",label:"Task",width:"500"}}),t._v(" "),a("el-table-column",{attrs:{width:"120",prop:"created_date","sort-method":t.sortDateTime,label:"Ngày tạo"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("moment")(e.row.created_date,"DD/MM/YYYY"))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"120",sortable:"","sort-method":t.sortDateTime,label:"Deadline"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("moment")(e.row.attributes_values[9],"DD/MM/YYYY"))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"150",sortable:"","sort-method":t.sortProgressDate,label:"Ngày còn lại"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("span",{class:t.getClassMessage(t.getSubtractTime(e.row).result)},[t._v("\n                        "+t._s(t.getMessageDeadline(t.getSubtractTime(e.row).result,t.getSubtractTime(e.row).diff))+"\n                    ")])])}}])}),t._v(" "),a("el-table-column",{attrs:{width:"180",filters:t.assingedUser,"filter-method":t.filterTag,"filter-placement":"bottom-end",prop:"assigned_to_extra_info[full_name_display]",label:"Người đảm nhận"}}),t._v(" "),a("el-table-column",{attrs:{width:"100",sortable:"",prop:"total_points",label:"Points"}}),t._v(" "),a("el-table-column",{attrs:{width:"120",prop:"is_closed",sortable:"",label:"Trạng thái"},scopedSlots:t._u([{key:"default",fn:function(t){return[t.row.is_closed?a("i",{staticClass:"el-icon-check"}):a("i",{staticClass:"el-icon-loading"})]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"",prop:"finish_date","sort-method":t.sortFinishDate,label:"Hoàn thành"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("moment")(e.row.finish_date,"DD/MM/YYYY")))])]}}])})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[50,100,200,300],"page-size":t.pageSize,layout:"sizes, prev, pager, next",total:parseInt(t.totalTask)},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e}}})],1)],1),t._v(" "),a("modal-detail-task",{attrs:{"custom-attr":t.dataProject.userstory_custom_attributes,points:t.dataProject.points,"task-detail":t.currentTaskData,"dialog-visible":t.dialogVisible,members:t.members,"data-project":t.dataProject},on:{"close-modal":t.closeModal}})],1)},staticRenderFns:[]};var B={name:"Main",components:{Gantt:a("VU/8")(M,Y,!1,function(t){a("ZCqq")},"data-v-cebf6b94",null).exports,Menu:k},data:function(){return{}}},L={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("gantt")],1)},staticRenderFns:[]};var U=a("VU/8")(B,L,!1,function(t){a("ciKj")},"data-v-873b805a",null).exports,E=a("mvHQ"),N=a.n(E),V={name:"Login",data:function(){return{userLoginData:{username:"",password:""}}},methods:{loginUser:function(){var t={username:this.userLoginData.username,password:this.userLoginData.password,type:"normal"};i.a.post(this.$urlAPI+"/auth",t).then(function(t){localStorage.setItem("token",""+t.data.auth_token),localStorage.setItem("userInfo",N()(t.data)),q.replace("/")})}},mounted:function(){localStorage.getItem("token")&&q.replace("/")}},R={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"login__title"},[a("h1",[t._v("Đăng nhập")])])])],1),t._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"login__container"},[a("el-form",{attrs:{"label-position":"top","label-width":"100px",model:t.userLoginData}},[a("el-form-item",{attrs:{label:"Tên đăng nhập"}},[a("el-input",{attrs:{placeholder:"Tên đăng nhập hoặc email"},model:{value:t.userLoginData.username,callback:function(e){t.$set(t.userLoginData,"username",e)},expression:"userLoginData.username"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"Mật khẩu"}},[a("el-input",{attrs:{type:"password"},model:{value:t.userLoginData.password,callback:function(e){t.$set(t.userLoginData,"password",e)},expression:"userLoginData.password"}})],1),t._v(" "),a("el-form-item",{staticClass:"login__button_group"},[a("el-button",{attrs:{type:"primary"},on:{click:t.loginUser}},[t._v("Đăng nhập")])],1)],1)],1)])],1)],1)},staticRenderFns:[]};var H=a("VU/8")(V,R,!1,function(t){a("cd18")},"data-v-6d73b2a4",null).exports;s.default.use(p.a);var q=new p.a({routes:[{path:"/",name:"Gantt",component:U},{path:"/login",name:"Login",component:H}]}),O=a("M4fF"),J=a.n(O),Z=a("8AgW"),G=a.n(Z);a("sXnP"),a("xoJ4"),a("5W1q"),a("yav+"),s.default.use(u.a,{locale:r.a}),s.default.use(i.a),s.default.use(m.a),s.default.use(J.a),s.default.use(c.a),s.default.use(G.a),s.default.config.productionTip=!1,s.default.prototype.$urlAPI="https://agilebackend.herokuapp.com/api/v1",window.Vue=s.default,window.myvue=new s.default({el:"#app",router:q,components:{App:f},template:"<App/>"}),s.default.component("multiselect",Multiselect)},ZCqq:function(t,e){},aqUQ:function(t,e){},aqYZ:function(t,e){},cd18:function(t,e){},ciKj:function(t,e){},"k/SZ":function(t,e){},tvR6:function(t,e){},"txc+":function(t,e){},w4ko:function(t,e){},xoGc:function(t,e){},xoJ4:function(t,e){},"yav+":function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.ec44ab074de0a360cf10.js.map